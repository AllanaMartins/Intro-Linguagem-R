---
title: "Aula 2 - Criando e e manipulando dados, noções de programação I  "
author: "Vitor Rios"
date: "16 de outubro de 2017"
output: 
  slidy_presentation: 
    highlight: kate
---
#Tipos de dados
Já vimos 3 tipos de valores de dados, mas existem outros 4 especiais
```{r}
class(1)
class("1")
class(1 == "1")
```

***
```{r}
10 / 0
sqrt(-3)
c(10,NA,30)
```
***
```{r}
fator = factor(1:3, levels=c("chuchu","goiaba","iogurte"))
fator
class(fator)
```
***
`Inf` representa valores infinitos, pode ser `+Inf` ou `-Inf`  

`NaN` Not a Number, resultado de operações matemáticas impossíveis  

`NA` Not Available, representa dados ausentes, útil para preencher tabelas e matrizes. A maioria das funções estatísticas do R possui um argumento `na.rm` que lida com valores ausentes  

`factor` especifica que um conjunto de valores representa os níveis de um fator, usado para análises de dados categóricos  

Ao ler dados de arquivos .csv, colunas representadas por caracteres são automaticamente convertidas em fatores. para eivtar isto, use o argumento `as.is = TRUE`  
    

#Criando um conjunto de dados simulado
Iremos investigar o crescimento dos dragões usando  quatro rações diferentes. Após mandar nossos estagiários fazerem os experimentos, temos os seguintes dados, em dezenas de quilos
```{r , tidy=TRUE}
vacas = c(121.72355, 103.79754, 130.15442, 98.29305, 103.43365, 102.44998,
          125.49993, 111.07215, 113.74047, 103.16081, 80.87149, 98.66692,
          65.09549, 155.74965, 88.30168, 147.43610, 114.60806, 109.87433,
          149.54772, 83.54137
          )
fazendeiros = c(77.91352, 78.07251, 81.95604, 75.64862, 78.45213, 79.11058,
                79.98952, 79.18127, 840.1635, 74.86860, 82.01886, 78.26936,
                77.94691, 78.75372, 77.64901, 77.64097, 77.19803, 72.48175,
                83.45336, 78.99681
)
virgens = c(127.9366, 201.7158, 136.1366, 136.5880, 131.7213, 118.1486, 
            125.7534, 139.6544, 163.5890, 139.7455, NA, 141.4450, 110.7311,
            157.5921, 176.8437, 102.8659, 121.8286, 134.7097, 157.1392, 166.7133
)
aventureiros = c(191.3721, 216.1671, 165.4380, 196.2730, 172.6565, 178.2955,
                 193.6687, 189.7674, 160.2968, 208.4400, 204.0934, 208.1798,
                 186.6380, 193.9446, 197.3650, 198.6853, 213.8838, 210.1881,
                 209.9109, 210.9228
)
```
***
Podemos juntar tudo num dataframe para facilitar
```{r}
alimento=c(rep("vacas",20),rep("fazendeiros",20),rep("virgens",20),rep("aventureiros",20))
dragoes = data.frame(x=alimento, y=c(vacas,fazendeiros,virgens,aventureiros))
head(dragoes)
summary(dragoes)
```
***
```{r}
plot(dragoes)
```
#Para facilitar suas análises
Formate seus dados sempre que possível da seguinte forma:
- Cada linha uma observação ou indivíduo
- Cada coluna uma variável
```{r}
summary(lm(dragoes$y~dragoes$x))
```

#Temos problemas
Erros de digitação em fazendeiros e em virgens
```{r}
max(dragoes[,2])
max(dragoes[,2], na.rm = T)
```
***
Erro na posição do decimal
```{r}
dragoes[dragoes== 840.1635] = 84.01635
max(dragoes[,2],na.rm = TRUE)
plot (dragoes)
```


#Para NA, não há remédio
Só verificando o dado original ou removendo
```{r}
mean(dragoes[,2]) ##qualquer cálculo com NA é igual a NA
mean(dragoes[,2], na.rm = TRUE)## na.rm = TRUE remove o NA para o calculo da média

aggregate(dragoes$y ~ dragoes$x,FUN = "mean")

```

# Para verificar erros de digitação ao trabalharmos com texto, podeos usar a função `unique()`
```{r}
### dados dispníveis em http://ecologia.ib.usp.br/bie5782/doku.php?id=dados:dados-caixeta
nomesComErro = read.table("arquivos/caixetaComErro.csv", header=T, sep=",")
head(nomesComErro)
unique(nomesComErro$especie)
#podemos também colocar os nomes em ordem alfabética
sort(unique(nomesComErro$especie))
```
***
```{r}
nomesComErro$especie[nomesComErro$especie=="Tabebuia casinoides"]="Tabebuia cassinoides"
nomesComErro$especie[nomesComErro$especie=="Tabebuia casssinoides"] = "Tabebuia cassinoides"
sort(unique(nomesComErro$especie))
```
#Entendendo o comando passo a passo:
````{r, echo=T, eval=F}
nomesComErro$especie[nomesComErro$especie=="Tabebuia casinoides"]="Tabebuia cassinoides"
````
1- Definir o que vamos substituir:   
```{r,eval=FALSE}
 nomesComErro$especie=="Tabebuia casinoides"
```
Este comando nos retorna um vetor lógico com as posições de todos elementos "Tabebuia casinoides" dentro do objeto nomesComErro, na coluna$especie    
1- Selecionar o que será substituído:
```{r,eval=F}
 nomesComErro$especie[nomesComErro$especie=="Tabebuia casinoides"]
```
retorna apenas os elementos que cumpre a condição dentro do colchete     
1- Substituir 
```{r, eval=F, tidy = TRUE}
nomesComErro$especie[nomesComErro$especie=="Tabebuia casinoides"]="Tabebuia cassinoides"
```
***
#Dica de estruturar seu script: pseudocódigo
Liste cada passo necessário

  verbo - objeto

- Ler dados do arquivo
- Verificar dados ausentes / errados
      - verificar NAs
      - verificar erros de digitação
      - verificar cabeçalhos
- Selecionar colunas para analisar
- Rodar análise
      - Passo 1
      - Passo 2
  _ ....

***
# pseudocódigo
Substitua pela função adequada do R  
Se necessário, quebre em sub itens

- Ler dados do arquivo
    - `file = read.table("preçosComida.csv")`
- Verificar dados ausentes / errados
      - verificar NAs
        - `is.na(file)`
      - verificar erros de digitação
        - `unique(file$species)`
      - verificar cabeçalhos
        - `head(file)`
- Selecionar colunas para analisar
      - `file$species[file$species!="Chuchu"]`
- Rodar análise
      - Passo 1
      - Passo 2
  _ ....

***

#Condicionais
Fazer algo _se_ uma condição ocorrer

```{r}
if (pi==3){
  message("Algo de errado não está certo")
  } else message("Algo de certo não está errado")
```

